C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN MAIN.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE MAIN.C LARGE OPTIMIZE(6,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(3)

line level    source

   1          /*
   2          ±¾²âÊÔ³ÌĞòÔÚ°²ĞÅ¿É¿Æ¼¼30Ôª µÄ²âÊÔ°åÉÏÕıÈ·ÔËĞĞ£¬ËùÓĞ°²ĞÅ¿É³öµÄµÄÄ£¿é´ÓESP-01µ½ESP-14¾ù¿ÉÒÔÕıÈ·ÔËĞĞ£¬ÓëÔ¶³Ì¿
             -ØÖÆ¡£
   3          */
   4          #include"SYS.H"
   5          #include"AT_PRC.H"
   6          #include"delay.h"
   7          #include <string.h>
   8          #include <stdio.h> /* for printf */
   9          
  10          extern void PWM(unsigned char r,unsigned char g,unsigned char b);
  11          extern void timer0_ini();
  12          extern bit have_change_pwm;
  13          extern void set_pwm(unsigned char data rr,unsigned char data gg,unsigned char data bb);
  14          extern void read_dh(void);
  15          extern unsigned char uart_time_out;
  16          extern bit uart_rec_date;
  17          extern bit uart_rec_new;
  18          unsigned char bar_r=0;
  19          unsigned char bar_g=0;
  20          unsigned char bar_b=0;
  21          unsigned char old_bar_r=0;
  22          unsigned char old_bar_g=0;
  23          unsigned char old_bar_b=0;
  24          
  25          extern unsigned int delay_1min;
  26          extern unsigned char TP_H;
  27          extern unsigned char TP_L;
  28          extern unsigned char RH_H;
  29          extern unsigned char RH_L;
  30          extern unsigned char CR_D;
  31          extern bit min_rech;
  32          code unsigned char RGB_CODE_R[]="LIGHTR:";
  33          code unsigned char RGB_CODE_G[]="LIGHTG:";
  34          code unsigned char RGB_CODE_B[]="LIGHTB:";
  35          unsigned int key1_time=0;
  36          unsigned char RGB_CODE[12];
  37          char *ii;
  38          
  39          /*-------------------------------------------------------------------------------------------------------
  40          º¯ÊıÃû³Æ:
  41          void ini_rec_buff(void)
  42          º¯Êı¹¦ÄÜ:
  43          °Ñ½ÓÊÕ»º³åÇåÁã£¬ÉèÖÃ´®¿Ú½ÓÊÕ»úÖÆÎª³õÊ¼£¬´®¿ÚËÑË÷Ö¸ÕëÖ¸ÏòNULL
  44          ±»±¾º¯Êıµ÷ÓÃµÄº¯ÊıÇåµ¥:
  45          ÎŞ
  46          µ÷ÓÃ±¾º¯ÊıµÄº¯ÊıÇåµ¥:
  47          void main(void)
  48          ÊäÈë²ÎÊıËµÃ÷:
  49          ÎŞ
  50          Êä³ö²ÎÊıµÄËµÃ÷:
  51          ÎŞ
  52          º¯Êı·µ»ØÖµµÄËµÃ÷:
  53          ÎŞ
  54          ÆäËüËµÃ÷:
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 2   

  55          Ã¿´Î´®¿ÚÊÕµ½Ò»´®Êı¾İ£¬ÒªÅĞ¶Ï´®¿Ú»º³åÇøÊÇ·ñ°üº¬¹Ø×¢µÄ×Ö·û´®£¬²¢Ïë³¹µ×Çå³ıÉÏ´Î½ÓÊÕµ½µÄ»º³å£¬µ÷ÓÃÕâ¸ö¡£
  56          --------------------------------------------------------------------------------------------------------
  57          */
  58          void ini_rec_buff(void)
  59          {
  60   1        unsigned char len=0;  
  61   1        for(len=0;len<64;len++)
  62   1        recd_buf[len]=0;
  63   1        RX1_Cnt=0;
  64   1        uart_rec_date=1;
  65   1        uart_time_out=0;
  66   1        uart_rec_new=0;
  67   1        ii=NULL;
  68   1      }
  69          /*-------------------------------------------------------------------------------------------------------
  70          º¯ÊıÃû³Æ:
  71          void uptemp(void)
  72          º¯Êı¹¦ÄÜ:
  73          ½«ÎÂ¶ÈºÍÊª¶ÈĞÅÏ¢ ¾­¹ıWIFIÄ£¿é´®¿Ú£¬·¢ËÍµ½·şÎñÆ÷£¬·şÎñÆ÷×ª·¢¸ø¿ØÖÆÖÕ¶Ë£¬±ÈÈçÊÖ»ú»òÕßµçÄÔ
  74          ±»±¾º¯Êıµ÷ÓÃµÄº¯ÊıÇåµ¥:
  75          make_AT_SEND_LEN£¨£©£»//¶¯Ì¬Éú³É·¢ËÍÊı¾İ³¤¶ÈATÖ¸Áî¡£
  76          at_uart_send_str()     //¾­¹ı±¾º¯Êı·¢ËÍÎÂ¶ÈĞÅÏ¢
  77          read_dh();          //¶ÁÈ¡DHT11µÄÎÂ¶ÈºÍÊª¶ÈĞÅÏ¢
  78          µ÷ÓÃ±¾º¯ÊıµÄº¯ÊıÇåµ¥:
  79          void main(void)
  80          ÊäÈë²ÎÊıËµÃ÷:
  81          ÎŞ
  82          Êä³ö²ÎÊıµÄËµÃ÷:
  83          ÎŞ
  84          º¯Êı·µ»ØÖµµÄËµÃ÷:
  85          ÎŞ
  86          ÆäËüËµÃ÷:
  87          --------------------------------------------------------------------------------------------------------
  88          */
  89          void uptemp(void)
  90          {
  91   1                  if(min_rech)                                     //   ¶¨Ê±Æ÷ÖÃÎ»min_rechÃ¿·ÖÖÓ»áÖ´ĞĞµ½ÕâÀïÒ»´Î
  92   1               {
  93   2               min_rech=0;
  94   2                need_seed_len=9;                                 
  95   2                make_AT_SEND_LEN(need_seed_len,RMT_data);       //¶¯Ì¬¹¹Ôì·¢ËÍAT³¤¶ÈÖ¸Áî
  96   2               at_uart_send_str(at_send_len_ox);                //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
  97   2                Delay2(1000);       
  98   2                at_uart_send_buf(temp_cd,need_seed_len);      //¾­¹ıWIFI¿ªÊ¼·¢ËÍÊı¾İ
  99   2               LED2=0;
 100   2               BEEP=1;
 101   2               Delay2(200);
 102   2                LED2=1;
 103   2               BEEP=0;                                          //ÉÁÁÁĞÄÌøÖ¸Ê¾µÆ£¬ºÍĞÄÌøÒô
 104   2                                                           //Ã¿30Ãë»áÔËĞĞµ½ÕâÀïÒ»´Î¡£¸üĞÂÒ»´ÎÎÂ¶ÈÊıÖµ
 105   2               read_dh();
 106   2               temp_cd[5]=(((RH_H%100)/10)+'0');
 107   2               temp_cd[6]=(((RH_H%10))+'0');
 108   2                temp_cd[7]=((RH_L)+'0');
 109   2               }       
 110   1      }
 111          /*------------------------------------------------------------------------------------------------------
 112          º¯ÊıÃû³Æ:
 113          void ack_rgb_bar(unsigned char bar_mod)
 114          º¯Êı¹¦ÄÜ:
 115          Ä£¿é¾­¹ı·şÎñÆ÷»ØÓ¦ÖÕ¶ËÉè±¸±¾WIFIÄ£¿é¿ØÖÆµÄµÆ¾ßºìÂÌÀ¶µÄÊıÖµ¡£ÊÖ»ú»òÕßµçÄÔ£¬ÊÕµ½Ô¶³ÌÄ£¿é»ØÓ¦¹ıÀ´µÄÊıÖµ£¬²Å¸ü
             -ĞÂ½ø¶ÈÌõ
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 3   

 116          ±»±¾º¯Êıµ÷ÓÃµÄº¯ÊıÇåµ¥:
 117          make_AT_SEND_LEN£¨£©£»//¶¯Ì¬Éú³É·¢ËÍÊı¾İ³¤¶ÈATÖ¸Áî¡£
 118          at_uart_send_str()     //¾­¹ı±¾º¯Êı·¢ËÍ±¾µØ R G B µÄÊıÖµ£¬´Ó0-99
 119          µ÷ÓÃ±¾º¯ÊıµÄº¯ÊıÇåµ¥:
 120          void main(void)
 121          ÊäÈë²ÎÊıËµÃ÷:
 122          ÎŞ
 123          Êä³ö²ÎÊıµÄËµÃ÷:
 124          ÎŞ
 125          º¯Êı·µ»ØÖµµÄËµÃ÷:
 126          ÎŞ
 127          ÆäËüËµÃ÷:
 128          ±¾º¯ÊıÓÃÀ´»ØÀ¡±¾µØ×´Ì¬µ½ÊÖ»úAPPÉÏ£¬±ÈÈçÊÖ»úÍÏ¶¯ºìÉ«µÆ½ø¶ÈÌõµ½85%£¬Ä£¿é½«ÊÕµ½LIGHR:85,Ä£¿éµ÷ÕûºìÉ«µÆÁÁ¶Èµ½8
             -5%ºó£¬»ØÀ¡Ò»¸ö LIGHR:85¡£
 129          ÊÖ»úAPPÖªµÀÔ¶³ÌµÆ¾ßÒÑ¾­Ö´ĞĞÁË£¬ÓÚÊÇ¸úĞÂ±¾µØºìÉ«Í¨µÀ½ø¶ÈÌõµ½85%
 130          --------------------------------------------------------------------------------------------------------
 131           */
 132          void ack_rgb_bar(unsigned char bar_mod)
 133          {
 134   1          unsigned char a=0;
 135   1         unsigned char temp_bar=0;
 136   1         for(a=0;a<12;a++)
 137   1         RGB_CODE[a]=0;
 138   1         for(a=0;a<7;a++)
 139   1         {
 140   2            if(bar_mod==1)
 141   2            {
 142   3            RGB_CODE[a]=RGB_CODE_R[a];
 143   3            }
 144   2            else if(bar_mod==2)
 145   2            {
 146   3            RGB_CODE[a]=RGB_CODE_G[a];
 147   3            }
 148   2            else if(bar_mod==3)
 149   2            {
 150   3            RGB_CODE[a]=RGB_CODE_B[a];
 151   3            }
 152   2         }
 153   1          if(bar_mod==1)
 154   1          temp_bar=bar_r;
 155   1          else if(bar_mod==2)
 156   1          temp_bar=bar_g;
 157   1          else if(bar_mod==3)
 158   1          temp_bar=bar_b;
 159   1         if(temp_bar>=10)
 160   1         {
 161   2         RGB_CODE[7]=(temp_bar/10)+'0';
 162   2         RGB_CODE[8]=(temp_bar%10)+'0';
 163   2         RGB_CODE[9]=0x0d;
 164   2         RGB_CODE[10]=0x0a;
 165   2         need_seed_len=11;
 166   2         }
 167   1         else
 168   1         {
 169   2         RGB_CODE[7]=temp_bar+'0';
 170   2         RGB_CODE[8]=0x0d;
 171   2         RGB_CODE[9]=0x0a;
 172   2         need_seed_len=10;
 173   2         }
 174   1         make_AT_SEND_LEN(need_seed_len,RMT_data);        //¶¯Ì¬¹¹Ôì·¢ËÍATÖ¸Áî
 175   1         at_uart_send_str(at_send_len_ox);                //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
 176   1         Delay2(50);
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 4   

 177   1         at_uart_send_buf(RGB_CODE,need_seed_len);      //¾­¹ıWIFI·¢ËÍÊı¾İ  
 178   1      } 
 179          /*------------------------------------------------------------------------------------------------------
 180          º¯ÊıÃû³Æ:
 181          void main(void£©
 182          Ö÷º¯ÊıÖ÷ÒªÍê³É¹¦ÄÜÈçÏÂ£º
 183          1 ´ò¿ªWIFI¹©µç£¬²¢ÈÃ·äÃùÆ÷²»Ïì£¬³õÊ¼»¯¸÷¸ö±äÁ¿µ½Ä¬ÈÏÖµ¡£
 184          2 ³õÊ¼»¯´®¿Ú ÖĞ¶Ï  ºÍPWM ÒÔ¼°¶¨Ê±Æ÷
 185          3 ÅĞ¶ÏÉÏµçÊ±¿ÌÊÇ·ñKEY1 ±»°´ÏÂ£¬Èô±»°´ÏÂºóÔÚÏÂÃæ»·½Ú£¬½«½øÈëSMARTLINK ×´Ì¬£¬ÉèÖÃ±¾Ä£¿éÁ¬Èë¼ÒÍ¥Â·ÓÉÆ÷µÄÕË»§º
             -ÍÃÜÂëĞÅÏ¢
 186          4 ÒÀ´Î·¢ËÍËÄÌõATÖ¸Áî£¬ÈÃÄ£¿éÁ¬µ½ÔÆ·şÎñÆ÷ÉÏ£¬´Ó¶øÊÖ»ú¿ÉÒÔÔ¶³Ì¿ØÖÆÕâ¸öÄ£¿éÁË¡£
 187            at_uart_send_str(AT_MODE);      //ÉèÖÃÄ£¿é½øÈëSTATION Ä£Ê½
 188            at_uart_send_str(AT_SMARTLINK);    //·¢ËÍ½øÈëSMARTLINK ATÖ¸Áî£¬Ä£¿é¿ÉÓÃÀ´»ñÈ¡¼ÒÍ¥Â·ÓÉÆ÷ÕË»§ÃÜÂëÁ¬µ½»¥ÁªÍøÉ
             -Ï¡£
 189            at_uart_send_str(AT_CLDSTART);     //·ÃÎÊ°²ĞÅ¿ÉµÄÔÆ·şÎñÆ÷¼ÓÈë°²ĞÅ¿ÉÔÆ¡£
 190            at_uart_send_str(AT_LANSTART);     //´ËÃüÁî£¬ÈÃÄ£¿é¾­¹ı±¾µØ¾ÖÓòÍø£¬¼àÌı±¾µØÊÖ»ú·¢¹ıÀ´µÄ²éÑ¯ĞÅÏ¢£¬ÊÖ»ú»ñµ
             -ÃÕâ¸öÄ£¿éµÄĞÅÏ¢ºó£¬Õâ¸öÊÖ»ú¼´¿ÉÏò·şÎñÆ÷ÉêÇë¶ÔÕâ¸öÄ£¿é¿ØÖÆ£¡
 191          5 ½Ó×Å½øĞĞ´óÑ­»·ÁË£¬¾­¹ıÉÏÃæµÄ²½Öè£¬Ä£¿éÒÑ¾­½øÈë½ÓÊÜÔ¶³ÌÊÖ»ú¿ØÖÆµÄ×´Ì¬£¬ÔÚÕâ¸öÑ­»·ÖĞ£¬Ö»ÓÃ¹Ø×¢´®¿Ú¹ıÀ´µÄÊı
             -¾İ£¨Ô¶³ÌÊÖ»ú¾­¹ı·şÎñÆ÷·¢¹ıÀ´µÄ¿ØÖÆÖ¸Áî£©
 192            ±ÈÈç ¿ª¹Ø¼ÌµçÆ÷£¬ÉèÖÃºìÂÌÀ¶ LEDÁÁ¶ÈµÄÃüÁî£¬±¾»úÖ´ĞĞºó£¬»¹ĞèÒª¸æËßÊÖ»ú£ºÎÒÒÑ¾­°´ÕÕÄãµÄÃüÁîÖ´ĞĞÁË£¡ Í¬Ê±Ã¿
             -·ÖÖÓ»¹Òª°Ñ±¾µØÎÂ¶È Êª¶È ¾­¹ı·şÎñÆ÷ ·¢ËÍ¸øÔ¶³ÌÊÖ»úAPPÉÏÏÔÊ¾£¡
 193            ÁíÍâÔÚÖ÷Ñ­»·ÖĞ£¬»¹°üº¬Ò»¸ö³¤°´KEY2 5Ãëºó£¬Ä£×é¸øÔÆ¶Ë·şÎñÆ÷·¢ËÍ½â°óÖ¸Áî£¬Ö÷¶¯ºÍÕâ¸öÊÖ»ú½â³ı°ó¶¨¡£
 194          --------------------------------------------------------------------------------------------------------
 195          */
 196          
 197          void delay_ms(unsigned int ms)
 198          {
 199   1         unsigned long dly = ms * 236ul;
 200   1         while(dly--);
 201   1      }
 202          
 203          
 204          
 205          //void blink(u8 inx, u16 ms){
 206          //    P2 &= ~(0x01<<(5+inx));
 207          //    delay_ms(ms);
 208          //    P2 |= (0x01<<(5+inx));
 209          //    delay_ms(ms);
 210          //}
 211          
 212          
 213          //void dumpValue(u8 inx,int n){
 214          // while(n--)
 215          //    blink(inx, 500ul);
 216          //}
 217          
 218          void main(void)
 219          {
 220   1         
 221   1      // while(1){
 222   1      //    P25=~P25;
 223   1      //    Delay2(1000ul);
 224   1      // }
 225   1      
 226   1         
 227   1         
 228   1         char z=0;
 229   1         unsigned int h=0;
 230   1         unsigned int i;
 231   1         WIFI_VCC=0;       //WIFI µçÔ´ÊÜµ¥Æ¬»ú¿ØÖÆ£¬ÔÚÒì³£µÄÊ±ºò£¬µ¥Æ¬»ú¿ÉÒÔÇ¿ÖÆÖØÆô¶¯ESP8266
 232   1         init_uart();      // ³õÊ¼»¯´®¿Ú²¨ÌØÂÊºÍESP8266 ´®¿ÚÄ£×éÏàÍ¬¡£
 233   1         BEEP=0;           //¹Øµô·äÃùÆ÷
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 5   

 234   1         Delay2(1000);     //ÑÓ³ÙÆô¶¯£¬ÈÃÏµÍ³¸üÎÈ¶¨
 235   1         old_bar_r=bar_r;   //³õÊ¼»¯ºìÂÌÀ¶ µÆµÄPWM Õ¼¿Õ±È0-99
 236   1         old_bar_g=bar_g;
 237   1         old_bar_b=bar_b;
 238   1         PWM(5,5,5);       //ÈÃÈı¸öµÆÎ¢ÁÁ
 239   1         timer0_ini();     //³õÊ¼»¯¶¨Ê±0£¬ÎªÒ»Ğ©ĞèÒªÊ±¼ä»ù×¼·şÎñµÄ¶«Î÷×ö×¼±¸¡£
 240   1      
 241   1      
 242   1            
 243   1         at_uart_send_str(AT_MODE);
 244   1         Delay2(500);
 245   1         ini_rec_buff();
 246   1         
 247   1         at_uart_send_str(AT_CIPMUX);      
 248   1         Delay2(500);
 249   1         
 250   1         at_uart_send_str(AT_CWJAP);       
 251   1         Delay2(1000);
 252   1      
 253   1         
 254   1         do                      
 255   1         {
 256   2            PWM(i%100,(i+33)%100,(i+66)%100);
 257   2            Delay2(50);    
 258   2            i = i>99? 0: i+1;
 259   2         }while(strstr(recd_buf,smartlink_code)==NULL);
 260   1            
 261   1         
 262   1         while(1){
 263   2            PWM(5,5,5);
 264   2            while(!K1);
 265   2               at_uart_send_str(AT_MODE);
 266   2               Delay2(500);
 267   2            
 268   2               at_uart_send_str("AT+CIPMUX=0");     
 269   2               Delay2(500);
 270   2      
 271   2               at_uart_send_str("AT+CIPSTART=\"TCP\",\"api.thingspeak.com\",80");       
 272   2               Delay2(1000);
 273   2      
 274   2               at_uart_send_str("AT+CIPSEND=54");      
 275   2               Delay2(1000);
 276   2      
 277   2               at_uart_send_str("GET /update?key=GJA4TBA1YS1V4VRW&field1=111&field2=123");       
 278   2               Delay2(5000);
 279   2               
 280   2               at_uart_send_str("AT+CIPCLOSE");     
 281   2               Delay2(500);
 282   2      
 283   2               while(1){
 284   3            //    BEEP=1; Delay2(500); BEEP=0;  
 285   3                  PWM(i%100,(i+33)%100,(i+66)%100);
 286   3                  Delay2(5);     
 287   3                  i = i>99? 0: i+1;
 288   3                  if(!K1) break;
 289   3               }
 290   2            
 291   2         }
 292   1         
 293   1         
 294   1      // if(K1==0)           //¿ª»úµÄÊ±ºò·¢ÏÖ°´¼ü1Ò²¾ÍÊÇMCU_P1.3 ±»°´ÏÂ£¬ÄÇÃ´ÖØĞÂÓÃATÖ¸ÁîÅäÖÃWIFIÄ£¿éÁ¬Â·ÓÉÆ÷µÄÉ
             -ÏÍøÕË»§ºÍÃÜÂë
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 6   

 295   1      // {
 296   1      //       LED2=0;
 297   1      //       BEEP=1;
 298   1      //       Delay2(200);
 299   1      //        LED2=1;
 300   1      //       BEEP=0;      //ÉÁÁÁĞÄÌøÖ¸Ê¾µÆ£¬ºÍĞÄÌøÒô
 301   1      //       have_config=1;
 302   1      // }   
 303   1      //    at_uart_send_str(AT_MODE);     //ÉèÖÃÄ£¿é½øÈëSTATION Ä£Ê½
 304   1      //        Delay2(500);
 305   1      //     ini_rec_buff();  
 306   1      //    if(have_config)                //ĞèÒªÅäÖÃ Ä£¿éÁ¬Èë±¾µØµÄÂ·ÓÉÆ÷ÕË»§ºÍÃÜÂë
 307   1      //    { 
 308   1      //    at_uart_send_str(AT_SMARTLINK);   //·¢ËÍ½øÈëSMARTLINK ATÖ¸Áî
 309   1      //    Delay2(500);
 310   1      //    }
 311   1         
 312   1      //    do                       //´ËÑ­»·Íê³ÉSMARTLINK µÄÅäÖÃ
 313   1      //    {
 314   1      //    BEEP=1;
 315   1      //    Delay2(500);
 316   1      //    BEEP=0;
 317   1      //    Delay2(500);
 318   1      //     }while(strstr(recd_buf,smartlink_code)==NULL); //´ËÑ­»·Íê³ÉSMARTLINK µÄÅäÖÃ
 319   1      
 320   1      //    uart_rec_new=0;
 321   1      //    at_uart_send_str(AT_CLDSTART); //¼ÓÈë°²ĞÅ¿ÉÔÆ
 322   1      //    Delay2(1000);
 323   1      //    at_uart_send_str(AT_LANSTART);//¿ªÆôÄÚÍøÄ£Ê½£¨´ËÄ£Ê½ÏÂ£¬Ä£×é»áÓÃÄÚÍø»ØÓ¦ÊÖ»úAPP Òª²éÑ¯µÄID ºÍKEY£©
 324   1      //    Delay2(500);
 325   1      //    while(1)
 326   1      //    {  
 327   1      //    if(have_change_pwm)          //¶¨Ê±Æ÷ÖÃÎ»ºó£¬10ºÁÃë½øÈëÒ»´Î ¼ÙÈçÔÚÑ­»·ÖĞ¼ì²âµ½ĞèÒª¸Ä±äR G B µÆµÄ±ä»¯¡£Ã¿1
             -0MS ¼Ó1»òÕß¼õ1 PWMÊıÖµ£¬´Ó×î°µµ½×îÁÁĞèÒª2.56Ãë
 328   1      //    {                     //ÕâÀïÓÃÀ´×ö½¥ÁÁ»òÕß½¥ÃğĞ§¹û
 329   1      //         have_change_pwm=0;     //Çå±êÖ¾
 330   1      //        if(K1==0)            //¼ÙÈçK1±»°´ÏÂ£¬¼ÇÂ¼°´ÏÂµÄÊ±¼ä³¤¶Ì¡£
 331   1      //         key1_time++;
 332   1      //         else
 333   1      //         key1_time=0;
 334   1      //         if(key1_time>500)       //K1 ±»Á¬Ğø°´ÏÂ³¬¹ı5Ãë
 335   1      //         {
 336   1      //          key1_time=0;
 337   1      //          at_uart_send_str(AT_CUB);  //³¬¹ı5Ãëºó£¬Ä£×é¾­¹ıATÖ¸ÁîÏò·şÎñÆ÷·¢³öÍË³ö¼ÒÍ¥×éÃüÁî
 338   1      //          BEEP=1;
 339   1      //          Delay2(100);            //·äÃùÆ÷ÏìÈıÉù£¬´ú±íÄ£¿éÒÑ¾­ÓëÕâ¸öÕËºÅ½â°ó
 340   1      //          BEEP=0;
 341   1      //          Delay2(100);
 342   1      //          BEEP=1;
 343   1      //         Delay2(100);
 344   1      //          BEEP=0;
 345   1      //          Delay2(100);
 346   1      //          BEEP=1;
 347   1      //          Delay2(100);
 348   1      //          BEEP=0;
 349   1      //       } 
 350   1      //        if(bar_r>old_bar_r)//bar_r Õâ¸ö±äÁ¿ÖĞ¼ÇÂ¼ÁË×îĞÂ´ÓWIFIÄ£¿é´®¿Ú»ñµÃµÄPWMÊıÖµ£¬Èô·¢ÏÖºÍ¾ÉµÄPWMÊıÖµÓĞ³
             -öÈë£¬ËµÃ÷ĞèÒª¸Ä±ä£¡ÄÇ¾Í°ÑÀÏµÄ¼ÇÂ¼Éı1»òÕß½µ1
 351   1      //        {                                  
 352   1      //          old_bar_r++;
 353   1      //          set_pwm(old_bar_r,old_bar_g,old_bar_b);//ÉèÖÃ¼Ó1ºóµÄPWMµ½PWM¼Ä´æÆ÷ÖĞ£¬µÆµÄÁÁ¶È»á±ä»¯
 354   1      //        }
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 7   

 355   1      //        else if(bar_r<old_bar_r)//bar_r Õâ¸ö±äÁ¿ÖĞ¼ÇÂ¼ÁË×îĞÂ´ÓWIFIÄ£¿é´®¿Ú»ñµÃµÄPWMÊıÖµ£¬Èô·¢ÏÖºÍ¾ÉµÄPWMÊıÖµ
             -ÓĞ³öÈë£¬ËµÃ÷ĞèÒª¸Ä±ä£¡ÄÇ¾Í°ÑÀÏµÄ¼ÇÂ¼Éı1»òÕß½µ1
 356   1      //        {
 357   1      //          old_bar_r--;
 358   1      //          set_pwm(old_bar_r,old_bar_g,old_bar_b);
 359   1      //        }
 360   1      //        if(bar_g>old_bar_g)
 361   1      //        {
 362   1      //          old_bar_g++;
 363   1      //          set_pwm(old_bar_r,old_bar_g,old_bar_b);
 364   1      //        }
 365   1      //        else if(bar_g<old_bar_g)
 366   1      //        {
 367   1      //          old_bar_g--;
 368   1      //          set_pwm(old_bar_r,old_bar_g,old_bar_b);
 369   1      //        }
 370   1      //        if(bar_b>old_bar_b)
 371   1      //        {
 372   1      //          old_bar_b++;
 373   1      //          set_pwm(old_bar_r,old_bar_g,old_bar_b);
 374   1      //        }
 375   1      //        else if(bar_b<old_bar_b)
 376   1      //        {
 377   1      //          old_bar_b--;
 378   1      //          set_pwm(old_bar_r,old_bar_g,old_bar_b);
 379   1      //        }
 380   1      //    }  
 381   1      //    if(uart_rec_new)//Õâ¸ö±êÖ¾Î»Îª1£¬´ú±íWIFI ÊÕµ½Êı¾İ´Ó´®¿ÚÊä³öµ½MCUµÄ´®¿Ú»º³åÇøÁË£¬²¢ÇÒ¹¹³ÉÒ»Ğ¡¶Î£¬¿ÉÒÔ·
             -ÖÎöÁË¡£¶¨Ê±Æ÷¼ÆÊ±£¬´ÓÊÕµ½´Ó´®¿Ú×îºóÒ»¸ö×Ö½Ú¿ªÊ¼10MS£¬ÈôÃ»ÓĞĞÂÊı¾İµ½À´¡£¾ÍËãÒ»Õû¶Î½áÊø£¡
 382   1      //    {
 383   1      //     if((ii=strstr(recd_buf,PCLD_code))!=NULL) // strstrÕâ¸öº¯ÊıÊÇKEIL±àÒëÆ÷µÄ×Ö·û´®¿âº¯Êı£¬¹¦ÄÜÊÇ´ÓÒ»¸ö×Ö
             -·û´®ÖĞ²éÕÒÊÇ·ñ´æÔÚÖ¸¶¨µÄ×Ö·û´®£¬Ã»ÕÒµ½·µ»ØNULL£¬ÕÒµ½ºó·µ»ØÕÒµ½µÄÎ»ÖÃ£¬¾ÍÊÇÖ¸Õë£¡
 384   1      //     {                               // ÕÒµ½LIGHT: ÕâÑùµÄ×Ö·û´®´æÔÚÓÚ´®¿Ú»º³åÇøÖĞ
 385   1      //       if(*(ii+6)=='0')                 //  LIGHT:0 ÅĞ¶Ï×îºóÒ»¸ö×Ö·û£¬ÊÇ0´ú±íÒª¹Ø¼ÌµçÆ÷
 386   1      //       {
 387   1      //              DK1=0;                 //¹Øµô¼ÌµçÆ÷
 388   1      //         need_seed_len=8;              //¹¹ÔìÉÏ´«Êı¾İµ½ÔÆ£¬×ª¸øÊÖ»úµÄÎÂ¶ÈÊı¾İ°ü£¬·ûºÏ»ù±¾Êı¾İ¸ñÊ½
 389   1      //         make_AT_SEND_LEN(need_seed_len,RMT_data);               //¶¯Ì¬¹¹Ôì·¢ËÍATÖ¸Áî
 390   1      //         at_uart_send_str(at_send_len_ox);                //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
 391   1      //         Delay2(50);
 392   1      //         at_uart_send_buf(switch_sta0,need_seed_len);       //¾­¹ıWIFI·¢ËÍÊı¾İ
 393   1      //         ///////////////////////////ÉÏÃæµÄ¼¸¸öAT·¢ËÍº¯Êı£¬°ÑÒÑ¾­¹Øµô¼ÌµçÆ÷µÄÏûÏ¢Í¨¹ı·şÎñÆ÷¸æËßAPP£¡APPÊÕµ½ºó
             -°Ñ½çÃæÉÏµÄµÆÉèÖÃÎª»ÒÉ«¹Ø±Õ×´Ì¬
 394   1      //         Delay2(20);
 395   1      //         bar_r=0;
 396   1      //         bar_g=0;
 397   1      //         bar_b=0;       //µãAPP¹ØµÆ×´Ì¬£¬°Ñ±¾µØµÄR G BÈı¸öµÆµÄPWMµÄÕ¼¿Õ±È È«ÉèÖÃÎª0
 398   1      //         ack_rgb_bar(1);
 399   1      //         ack_rgb_bar(1);
 400   1      //         ack_rgb_bar(2);
 401   1      //         Delay2(50);
 402   1      //         ack_rgb_bar(3);//ÉÏÃæ¼¸¸öack_rgb_bar º¯Êı£¬°Ñ±¾µØRGB µÄÕ¼¿Õ±È¾­¹ıÔÆ·şÎñÆ÷·´À¡¸øÊÖ»úAPP£¬ÈÃÊÖ»úAPP¸ü
             -ĞÂÍÏ¶¯Ìõ
 403   1      //         Delay2(50);
 404   1      //       }
 405   1      //       if(*(ii+6)=='1')                 //  LIGHT:1 ÅĞ¶Ï×îºóÒ»¸ö×Ö·û£¬ÊÇ0´ú±íÒª¿ª¼ÌµçÆ÷
 406   1      //       {
 407   1      //              DK1=1;
 408   1      //         need_seed_len=8;              //¹¹ÔìÉÏ´«Êı¾İµ½ÔÆ£¬×ª¸øÊÖ»úµÄÎÂ¶ÈÊı¾İ°ü£¬·ûºÏ»ù±¾Êı¾İ¸ñÊ½
 409   1      //         make_AT_SEND_LEN(need_seed_len,RMT_data);               //¶¯Ì¬¹¹Ôì·¢ËÍATÖ¸Áî
 410   1      //         at_uart_send_str(at_send_len_ox);                  //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
 411   1      //         Delay2(20);
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 8   

 412   1      //         at_uart_send_buf(switch_sta1,need_seed_len);       //¾­¹ıWIFI·¢ËÍÊı¾İ 
 413   1      //         Delay2(50);
 414   1      //         bar_r=99;
 415   1      //         bar_g=99;
 416   1      //         bar_b=99;
 417   1      //         ack_rgb_bar(1);
 418   1      //         ack_rgb_bar(1);
 419   1      //         ack_rgb_bar(2);
 420   1      //         Delay2(50);
 421   1      //         ack_rgb_bar(3);
 422   1      //         Delay2(50);
 423   1      //       }
 424   1      //       ini_rec_buff();
 425   1      //       uart_rec_new=0;
 426   1      //     }
 427   1      //     else if(((ii=strstr(recd_buf,LIGHTR_code))!=NULL)&&(old_bar_r==bar_r)) //ÔÚ´®¿Ú»º³åÇøÖĞ£¬ÕÒµ½LIGHTR:X
             -X ÕâÑùÉèÖÃºìÂÌÀ¶PWM µÄ×Ö·û´®ÃüÁî
 428   1      //     {                                                    //µ±ĞÂ¾ÉPWMÊıÖµÏàÍ¬£¬Ò²¾ÍÊÇÉÏ´Î²Ù×÷µÄÁÁ¶ÈPWM½¥±ä¹ı³ÌÍê³Éºó£¨old_bar_r==bar_r)²ÅÔÊĞ
             -í½øĞĞ
 429   1      //       old_bar_r=bar_r;                                         
 430   1      //       if((*(ii+8)==0)||(*(ii+8)==0x0d))
 431   1      //       bar_r=(*(ii+7)-'0');
 432   1      //       else if((*(ii+9)==0)||(*(ii+9)==0x0d))
 433   1      //       bar_r=(*(ii+7)-'0')*10+(*(ii+8)-'0');  //ÉÏÃæµÄÓï¾ä¹ıÈ¥³öLIGHTR;XX ÖĞ°ÑXXÕâ¸ö×Ö·û£¬±ä³ÉÊı×Ö£¡È»ºó²Å
             -ÄÜ¸øPWM¸³Öµ
 434   1      //       ack_rgb_bar(1);                    //Ä£¿é»ØÓ¦ĞÅÏ¢¸øÔ¶³ÌÊÖ»úÉÏµÄAPP ¸üĞÂ½ø¶ÈÌõ
 435   1      //     }
 436   1      //     else if(((ii=strstr(recd_buf,LIGHTG_code))!=NULL)&&(old_bar_g==bar_g))
 437   1      //     {
 438   1      //       old_bar_g=bar_g;
 439   1      //       if((*(ii+8)==0)||(*(ii+8)==0x0d))
 440   1      //       bar_g=(*(ii+7)-'0');
 441   1      //       else if((*(ii+9)==0)||(*(ii+9)==0x0d))
 442   1      //       bar_g=(*(ii+7)-'0')*10+(*(ii+8)-'0');
 443   1      //       ack_rgb_bar(2);
 444   1      //     }
 445   1      //     else if(((ii=strstr(recd_buf,LIGHTB_code))!=NULL)&&(old_bar_b==bar_b))
 446   1      //     {
 447   1      //       
 448   1      //       old_bar_b=bar_b;
 449   1      //       if((*(ii+8)==0)||(*(ii+8)==0x0d))
 450   1      //       bar_b=(*(ii+7)-'0');
 451   1      //       else if((*(ii+9)==0)||(*(ii+9)==0x0d))
 452   1      //       bar_b=(*(ii+7)-'0')*10+(*(ii+8)-'0');
 453   1      //       ack_rgb_bar(3);
 454   1      //     }
 455   1      //     ini_rec_buff(); //Ã¿´ÎÅĞ¶ÏÍêºó£¬ÇåÉ¨´®¿Ú»º³åÇø ºÍ½ÓÊÕÍê³É±êÖ¾
 456   1      //     uart_rec_new=0;
 457   1      //    }
 458   1      //    uptemp();       //¿´ÊÇ·ñĞèÒª¸üĞÂÎÂ¶ÈĞÅÏ¢
 459   1      //    }
 460   1      }
 461          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    940    ----
   CONSTANT SIZE    =    638    ----
   XDATA SIZE       =     67       9
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =     96    ----
C51 COMPILER V9.56.0.0   MAIN                                                              10/07/2016 16:25:46 PAGE 9   

   BIT SIZE         =     10    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
